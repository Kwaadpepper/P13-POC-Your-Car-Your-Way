<configuration>
  <springProperty name="SERVICE_NAME" source="spring.application.name"/>
  <springProperty name="SERVICE_URL" source="config.loki.url"/>
  <springProperty name="LOKI_ENABLED" source="config.loki.enabled"/>

  <statusListener class="ch.qos.logback.core.status.OnConsoleStatusListener"/>

  <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
    <encoder>
      <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{36} - %msg %mdc%n</pattern>
    </encoder>
  </appender>

  <appender name="LOKI" class="com.ycyw.shared.utils.LokiHttpAppender">
    <enabled>${LOKI_ENABLED}</enabled>
    <url>${SERVICE_URL}</url>
    <serviceName>${SERVICE_NAME}</serviceName>
    <includeMdc>true</includeMdc>

    <mdcAsLabels>true</mdcAsLabels>
    <mdcLabelKeys>service</mdcLabelKeys>
    <gzipEnabled>false</gzipEnabled>
  </appender>

  <!-- Async wrapper -->
  <appender name="ASYNC_LOKI" class="ch.qos.logback.classic.AsyncAppender">
    <appender-ref ref="LOKI"/>
    <queueSize>8192</queueSize>
    <discardingThreshold>95</discardingThreshold>
    <neverBlock>true</neverBlock>
  </appender>

  <root level="INFO">
    <appender-ref ref="STDOUT"/>
    <appender-ref ref="ASYNC_LOKI"/>
  </root>
</configuration>
