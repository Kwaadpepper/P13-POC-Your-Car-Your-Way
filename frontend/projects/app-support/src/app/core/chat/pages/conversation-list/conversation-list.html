<div class="container">
  <div class="row min-h-14 mb-3">
    <div class="col flex flex-col md:flex-row">
      <support-back-button backUrl=".." label="Support"></support-back-button>

      <div
        class="flex-grow flex flex-wrap justify-between items-center w-full md:w-auto"
      >
        <h1
          class="!m-4 text-ellipsis whitespace-nowrap overflow-hidden max-w-full"
        >
          Conversations
        </h1>
      </div>
    </div>
  </div>
  @if (loading()) {
    <div class="row">
      <div class="col text-center">
        <p-progressSpinner></p-progressSpinner>
      </div>
    </div>
  }
  @if (loadingError()) {
    <div class="row">
      <div class="col">
        <p-message
          severity="error"
          text="Une erreur est survenue lors du chargement des conversations."
        ></p-message>
      </div>
    </div>
  }
  @if (conversations().length < 1) {
    <div class="row">
      <div class="col">
        <p-message severity="info">Aucune conversation trouvée.</p-message>
      </div>
    </div>
  } @else {
    <div class="row">
      <div class="col">
        <p-listbox
          [options]="conversations()"
          [optionLabel]="'title'"
          [filter]="true"
          [filterPlaceHolder]="'Rechercher…'"
          (onChange)="open($event.value)"
          [metaKeySelection]="false"
          class="block w-full md:max-h-screen overflow-y-auto"
          [scrollHeight]="'65vh'"
        >
          <ng-template let-item pTemplate="item">
            <div class="item">
              <p-avatar
                [label]="avatarLabel(item)"
                class="mr-2"
                shape="circle"
              ></p-avatar>
              <div class="content">
                <div class="row">
                  <span class="title">{{ item.title }}</span>
                  <span class="updated">{{
                    item.updatedAt | date: "short"
                  }}</span>
                </div>
                @if (item.lastMessage) {
                  <div class="row">
                    <span class="last">{{
                      item.lastMessage.content || "—"
                    }}</span>
                    @if (item.unread > 0) {
                      <p-badge [value]="item.unread" severity="danger" />
                    }
                  </div>
                } @else {
                  <div class="row">
                    <span class="last italic">Aucun message</span>
                  </div>
                }
              </div>
            </div>
          </ng-template>
        </p-listbox>
      </div>
    </div>
  }
</div>
