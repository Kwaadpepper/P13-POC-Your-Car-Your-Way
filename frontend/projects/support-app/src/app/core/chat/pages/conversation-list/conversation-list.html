<div class="container">
  <div class="row min-h-14 mb-3">
    <div class="col flex flex-col md:flex-row">
      <support-back-button backUrl=".." label="Support"></support-back-button>

      <div
        class="flex-grow flex flex-wrap justify-between items-center w-full md:w-auto"
      >
        <h1
          class="!m-4 text-ellipsis whitespace-nowrap overflow-hidden max-w-full"
        >
          Conversations
        </h1>
        <button pButton (click)="newConversation()" size="small">
          <i class="pi pi-plus"></i>
        </button>
      </div>
    </div>
  </div>
  @if (conversations().length < 1) {
    <div class="row">
      <div class="col">
        Aucune conversation trouvée.
        <p-message severity="info"
          >Commencez une nouvelle conversation.</p-message
        >
        <button pButton label="Nouvelle" (click)="newConversation()">
          <i class="pi pi-plus"></i>
        </button>
      </div>
    </div>
  } @else {
    <div class="row">
      <div class="col">
        <p-listbox
          [options]="conversations()"
          [optionLabel]="'title'"
          [filter]="true"
          [filterPlaceHolder]="'Rechercher…'"
          (onChange)="open($event.value)"
          [metaKeySelection]="false"
          class="block w-full h-screen"
        >
          <ng-template let-item pTemplate="item">
            <div class="item">
              <p-avatar
                [label]="avatarLabel(item)"
                class="mr-2"
                shape="circle"
              ></p-avatar>
              <div class="content">
                <div class="row">
                  <span class="title">{{ item.title }}</span>
                  <span class="updated">{{
                    item.updatedAt | date: "short"
                  }}</span>
                </div>
                <div class="row">
                  <span class="last">{{
                    item.lastMessage.content || "—"
                  }}</span>
                  @if (item.unread > 0) {
                    <p-badge [value]="item.unread" severity="danger" />
                  }
                </div>
              </div>
            </div>
          </ng-template>
        </p-listbox>
      </div>
    </div>
  }
</div>
