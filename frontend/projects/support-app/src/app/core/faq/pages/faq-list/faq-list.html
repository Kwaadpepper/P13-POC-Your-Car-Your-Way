<div class="container">
  <div class="row min-h-14 mb-3">
    <div class="col flex flex-col md:flex-row">
      <support-back-button backUrl=".." label="Support"></support-back-button>

      <h1
        class="!m-4 text-ellipsis whitespace-nowrap overflow-hidden max-w-full"
      >
        FAQ
      </h1>
    </div>
  </div>

  <!-- Toolbar -->
  <div class="row mb-6">
    <div class="col-12">
      <div
        class="flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"
      >
        <!-- Bloc gauche -->
        <div class="flex flex-col md:flex-row gap-4 w-full lg:w-auto">
          <!-- Recherche -->
          <div class="relative w-full md:w-72">
            <label class="sr-only" for="faq-search">Recherche</label>
            <i
              class="pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-surface-500 text-sm"
            ></i>
            <input
              id="faq-search"
              pInputText
              type="text"
              class="pl-9 w-full"
              placeholder="Rechercher..."
              [(ngModel)]="searchValue"
            />
            <button
              pButton
              type="button"
              icon="pi pi-times"
              class="absolute right-3 top-1/2 -translate-y-2/3 text-surface-500"
              (click)="searchValue.set('')"
              [disabled]="!searchValue"
              title="Effacer la recherche"
              text="true"
              severity="secondary"
              size="small"
            ></button>
          </div>

          <!-- Filtre type -->
          <p-select
            class="min-w-52"
            [options]="faqTypeOptions()"
            [(ngModel)]="selectedType"
            [showClear]="true"
            placeholder="Tous les types"
          />

          <!-- Group toggle -->
          <p-toggleButton
            onLabel="Groupé"
            offLabel="Listé"
            [onIcon]="'pi pi-folder-open'"
            [offIcon]="'pi pi-list'"
            [ngModel]="groupByType()"
            (onChange)="toggleGroupByType()"
          />
        </div>
      </div>
    </div>
  </div>

  <!-- Contenu -->
  <div class="row mb-5">
    <div class="col-12">
      @if (viewModel.loading()) {
        <div class="space-y-3" aria-label="Chargement des FAQs">
          @for (sk of skeletonItems; track sk) {
            <p-skeleton height="2.25rem" class="rounded"></p-skeleton>
          }
        </div>
      } @else {
        <!-- MODE GROUPE -->
        @if (groupByType()) {
          @if (groupedFaqs().length > 0) {
            <div class="faq-groups space-y-5">
              <p-accordion [multiple]="true">
                @for (group of groupedFaqs(); track group.type) {
                  <p-accordion-panel>
                    <p-accordion-header
                      >{{ group.type }} ({{
                        group.faqs.length
                      }})</p-accordion-header
                    >
                    <p-accordion-content>
                      <div class="space-y-6">
                        @for (faq of group.faqs; track faq.id) {
                          <article
                            class="faq-item border border-surface-200 dark:border-surface-700 rounded-md p-4 bg-surface-50 dark:bg-surface-800 shadow-sm"
                            [attr.data-faq-id]="faq.id"
                          >
                            <header
                              class="flex flex-wrap items-center gap-2 mb-2"
                            >
                              <h3
                                class="m-0 text-base font-semibold text-surface-800 dark:text-surface-100"
                              >
                                {{ faq.question }}
                              </h3>
                              <p-tag
                                [value]="faq.type"
                                severity="info"
                                styleClass="text-xs"
                              >
                              </p-tag>
                            </header>
                            <p
                              class="answer text-sm leading-relaxed text-surface-700 dark:text-surface-200 m-0"
                            >
                              {{ faq.answer }}
                            </p>
                          </article>
                        }
                      </div>
                    </p-accordion-content>
                  </p-accordion-panel>
                }
              </p-accordion>
            </div>
          } @else {
            <div class="empty-state">
              <i class="pi pi-info-circle text-3xl"></i>
              <p>Aucune FAQ ne correspond aux critères.</p>
            </div>
          }
        } @else {
          <!-- MODE LISTE SIMPLE -->
          @if (filteredFaqs().length > 0) {
            <div class="faq-flat">
              <p-accordion [multiple]="true">
                @for (faq of filteredFaqs(); track faq.id) {
                  <p-accordion-panel>
                    <p-accordion-header>{{ faq.question }}</p-accordion-header>
                    <p-accordion-content>
                      <div class="space-y-3">
                        <p
                          class="answer text-sm leading-relaxed text-surface-700 dark:text-surface-200 m-0"
                        >
                          {{ faq.answer }}
                        </p>
                        <div class="flex items-center gap-2">
                          <p-tag
                            [value]="faq.type"
                            severity="info"
                            styleClass="text-xs"
                          >
                          </p-tag>
                        </div>
                      </div>
                    </p-accordion-content>
                  </p-accordion-panel>
                }
              </p-accordion>
            </div>
          } @else {
            <div class="empty-state">
              <i class="pi pi-info-circle text-3xl"></i>
              <p>Aucune FAQ ne correspond aux critères.</p>
            </div>
          }
        }
      }
    </div>
  </div>
</div>
